import requests
import sys
import urllib3
from requests.packages.urllib3.exceptions import InsecureRequestWarning
from packaging import version

urllib3.disable_warnings(InsecureRequestWarning)

vulnerable_versions = ['1.3.9', '1.4.0']
vulnerable_range = (version.parse('1.3.9'), version.parse('1.4.0'))

def is_vulnerable(version_string):
    parsed_version = version.parse(version_string)
    return vulnerable_range[0] <= parsed_version <= vulnerable_range[1]

def get_nginx_version(url):
    try:
        response = requests.get(url, timeout=3, verify=False)
        server_header = response.headers.get('Server', '')
        
        if 'nginx' in server_header.lower():
            parts = server_header.split('/')
            if len(parts) > 1:
                version_string = parts[1]
                vulnerable = is_vulnerable(version_string)
                print(f"[{'!' if vulnerable else '+'}] Target: {url} Nginx version: {version_string} Vulnerable: {vulnerable}")
            else:
                print(f"[?] Target: {url} Nginx detected but no version specified")
        else:
            print("[-] The server does not appear to be running Nginx.")
    
    except requests.RequestException as e:
        print(f"[-] An error occurred: {e}")

if __name__ == "__main__":
    try:
        url = sys.argv[1]
        get_nginx_version(url)
    except IndexError:
        print("[*] Usage: python3 nginx_cve_2013_2028_checker.py http://127.0.0.1")
